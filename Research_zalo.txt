- V·ªõi web th√¨ d√≤ websocket -> h√†m open websocket -> ra listener message -> d√≤ ra _onRawData -> _onData ƒë·ªÉ x·ª≠ l√Ω message sau khi ƒë√£ decrypt v√† h√†m decrypt -> ƒë∆∞a v√†o chatgpt ƒë·ªÉ generate ra code decrypt v·ªõi key ƒë∆∞·ª£c t·∫°o ra ·ªü m·ªói session

- V·ªõi zalo window app th√¨ n√≥ ƒëang ƒë∆∞·ª£c build b·∫±ng electron -> web-based app -> unpackaged ra ƒë·∫∑t t√™n folder l√† app, move app.asar qua ch·ªó kh√°c, t·∫°o 1 file app.asar kh√°c v·ªõi n·ªôi dung l√† :echo "{}" -> ƒë·ªÉ n√≥ fallback v·ªÅ folder app (do trong logic c·ªßa Zalo.exe s·∫Ω check xem app.asar c√≥ hay kh√¥ng) -> sau ƒë√≥ x√†i JS-Beautify for VS Code extension (·∫•n F1 -> beautify) ƒë·ªÉ generate ra code d·ªÖ ƒë·ªçc h∆°n

- Flow t√¨m th√¨ t·ª´ vi·ªác open WebSocket -> d√≤ ra c√°c listener li√™n quan -> d√≤ ra h√†m s·ª≠ d·ª•ng ƒë·ªÉ decrypt

- H√†m x·ª≠ l√Ω undo trong database v√† tin nh·∫Øn m·ªõi nh·∫≠n t·ªõi

- beautify b·∫±ng js-beautify : Get-ChildItem .\ -Recurse -Filter *.js | ForEach-Object { js-beautify $_.FullName -r }

- replace b·∫±ng git grep: git grep -l 'devTools: !1' | xargs sed -i 's/devTools: !1/devTools: true/g'

- debug UI electron: Zalo.exe --remote-debugging-port=9222
- debug main.js electron : Zalo.exe --inspect=9229
-> Zalo.exe --inspect=9229 --remote-debugging-port=9222
edge://inspect/#devices
chrome://inspect/#devices

- ƒëem console.log v·ªÅ:
	const iframe = document.createElement('iframe');
	iframe.style.display = 'none';
	document.body.appendChild(iframe);

	// G√°n l·∫°i console.log t·ª´ iframe
	console.log = iframe.contentWindow.console.log.bind(window);

- string to json: JSON.parse()

- H√†m IIFE search full path t·ªõi `this` (t·∫°o scope ri√™ng): (nh·∫≠p v√†o console)
	(() => {
		const target = this._onData;

		const deepTrace = (obj, path = "window", visited = new WeakSet()) => {
			if (visited.has(obj)) return;
			visited.add(obj);

			for (let key in obj) {
				try {
					const val = obj[key];
					const fullPath = `${path}.${key}`;
					if (val === target) {
						console.log("üîç Found at", fullPath);
					} else if (typeof val === "object" && val !== null) {
						deepTrace(val, fullPath, visited);
					}
				} catch (e) {}
			}
		};

		deepTrace(window);
	})();

Tampermonkey script:
https://github.com/Tampermonkey/tampermonkey/issues/2384
	- Send to telegram:
		// ==UserScript==
		// @name         Zalo to Telegram
		// @namespace    http://tampermonkey.net/
		// @version      1.0
		// @description  G·ª≠i tin nh·∫Øn t·ª´ Zalo sang Telegram
		// @match        https://chat.zalo.me/*
		// @grant        GM_xmlhttpRequest
		// @grant        unsafeWindow
		// @connect      api.telegram.org
		// @sandbox     JavaScript
		// ==/UserScript==

		(function() {
			'use strict';

			const BOT_TOKEN = "";
			const CHAT_ID = "";

			window.addEventListener("message", function(event) {
				if (event.data?.type === "ZALO_DATA") {
					const a = event.data.payload;
					const content = a?.data?.msgs?.[0]?.content || "[Kh√¥ng c√≥ n·ªôi dung]";
					const sender = a?.data?.msgs?.[0]?.dName || "Unknown";

					const text = `üí¨ Tin nh·∫Øn t·ª´ ${sender}:\n${content}`;

					GM_xmlhttpRequest({
						method: "POST",
						url: `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,
						headers: {
							"Content-Type": "application/x-www-form-urlencoded"
						},
						data: `chat_id=${CHAT_ID}&text=${encodeURIComponent(text)}`,
						onload: function(response) {
							console.log("‚úÖ G·ª≠i Telegram:", response.responseText);
						},
						onerror: function(err) {
							console.error("‚ùå L·ªói g·ª≠i:", err);
						}
					});

				}
			});
		})();

	- Patch chat.zalo.me ch·∫∑n undo v√† g·ªüi message t·ªõi tele:
		// ==UserScript==
		// @name         New 2
		// @namespace    http://tampermonkey.net/
		// @version      2025-09-12
		// @description  try to take over the world!
		// @author       You
		// @match        https://chat.zalo.me/*
		// @run-at       document-start
		// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
		// @grant        none
		// ==/UserScript==

		(function() {
			'use strict';

			// Kh√¥i ph·ª•c console.log g·ªëc ƒë·ªÉ tr√°nh b·ªã web override
			const iframe = document.createElement('iframe');
			document.body.appendChild(iframe);
			console.log = iframe.contentWindow.console.log.bind(window.console);


			function restoreConsole() {
				const iframe = document.createElement('iframe');
				document.body.appendChild(iframe);
				console.log = iframe.contentWindow.console.log.bind(window.console);
			}

			function hookSocket(socketObj) {
				if (!socketObj || typeof socketObj._onData !== 'function') return;
				console.log("üéØ Hooking _onData on", socketObj);

				const orig = socketObj._onData;
				socketObj._onData = function(e, t, n, a) {
					console.log("a =", a);
					try {
						let parsed = a;
						let isString = false;

						if (typeof a === "string") {
							parsed = JSON.parse(a);
							isString = true;
						}
						//if (typeof a === "string") parsed = JSON.parse(a);

						if (
							parsed?.data?.msgs &&
							parsed.data.msgs.some(msg => msg.msgType === "chat.undo")
						) {
							console.log("‚è© B·ªè qua x·ª≠ l√Ω v√¨ msgType = chat.undo");
							parsed.data.msgs[0].msgType = "chat.undo_fake";

							// G·ª≠i n·ªôi dung ra ngo√†i qua postMessage
							window.postMessage({
								type: "ZALO_DATA",
								payload: parsed
							}, "*");

							// N·∫øu ban ƒë·∫ßu l√† string ‚Üí stringify l·∫°i ƒë·ªÉ thay th·∫ø trong a
							if (isString) {
								a = JSON.stringify(parsed);
							} else {
								a = parsed;
							}

							return orig.apply(this, [e, t, n, a]); // Kh√¥ng g·ªçi h√†m g·ªëc
						}
					} catch (err) {
						console.warn("L·ªói khi check a:", err);
					}
					return orig.apply(this, [e, t, n, a]);
				};
			}

			// ƒê·ª£i t·ªõi khi object xu·∫•t hi·ªán r·ªìi hook
			function waitForSocket() {
				const target = window.$$afmc?.socketPolling?._chatHandler?._socket;
				if (target && typeof target._onData === 'function') {
					hookSocket(target);
				} else {
					setTimeout(waitForSocket, 50);
				}
			}

			waitForSocket();



		})();